<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
</head>
<body>
    <section>
        <form onsubmit="ExpenseList(event)">
            <div>
                <label for="expenseAmnt">Choose Expense Amount: </label>
                <input type="number" id="expenseamnt" name="expenseAmnt"> 
            </div>
            <div>
                <label for="desc">Choose Description: </label>
                <input type="text" id="desc" name="desc"> 
            </div>
            <div>
                <label for="categoryList">Choose a Category: </label>
                <input list="category" id="categoryList" name="categoryList"> 
                <datalist id="category">
                    <option value="Food">
                   <option value="Petrol">
                   <option value="Salary">
                 </datalist>
            </div>
            <input class="btn" type="submit" value="Add Expense">
        </form>
        <ul  id="list-item" ></ul>
    </section>
          
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

    <script>
         function ExpenseList(e)
         {
           e.preventDefault();
           
            const obj={
                expenseAmnt: e.target.expenseAmnt.value,
                desc: e.target.desc.value,
                categoryList: e.target.categoryList.value
              
            }

            
           axios.post("http://localhost:3000/expense/add-expense",obj)
            .then((response)=>{
              ShowonScreen(response.data)
              //console.log(response)
            }).catch((err)=>{
              document.body.innerHTML= document.body.innerHTML+ "<h4>Something Went Wrong</h4>"
              console.log(err)
            })

          }

          const deleteExpense=(postIdToDelete)=>{

              axios.delete(`http://localhost:3000/expense/delete-expense/${postIdToDelete}`)
               .then((response)=>{
                  //console.log(response)
                  }).catch((err)=>{
                  document.body.innerHTML= document.body.innerHTML+ "<h4>Something Went Wrong</h4>"
              console.log(err)
                })
                  }


          window.addEventListener("DOMContentLoaded",()=>{

          axios.get("http://localhost:3000/expense/get-expense")
            .then((response)=>{
              // ShowonScreen(response.data)
          
              for(var i=0;i<response.data.length;i++)
            {
              ShowonScreen(response.data[i])
            }
              //console.log(response)
            }).catch((err)=>{
              document.body.innerHTML= document.body.innerHTML+ "<h4>Something Went Wrong</h4>"
              console.log(err)
            })
          })

           function ShowonScreen(obj)
          {
            

            const parentElement=document.getElementById('list-item');
            const childElement= document.createElement('li');
            childElement.textContent=obj.expenseAmnt+ ' - '+obj.desc+ ' - '+obj.categoryList+ ' ';
            
            const deleteButton=document.createElement('input');

            deleteButton.type="button";
            deleteButton.value='Delete Expense';

          
            deleteButton.onclick=()=>{
              deleteExpense(obj.id)
              parentElement.removeChild(childElement);

            }
            childElement.appendChild(deleteButton);
            parentElement.appendChild(childElement);

          }          
          
    </script>



</body>
</html>